{% load static %}

{% for resposta in respostas %}
    {% if forloop.first %}
        <p>
            <a href="#" onclick="alternarRespostas({{ resposta.resposta_a.id }}); return false;" id="btn-toggle-{{ resposta.resposta_a.id }}" class="resposta-toggle-link">
                <span class="toggle-icon" style="font-weight: 900; font-size: 18px; color: black;">+</span> Mostrar respostas
            </a>
        </p>
        <div id="respostas-do-{{ resposta.resposta_a.id }}" class="respostas-container" style="display: none;">
    {% endif %}

    <div class="resposta-box-x8r29a" style="margin-left: {{ nivel|add:'1' }}0px;">
        <div class="resposta-autor-info">
            {% if resposta.autor.perfil.foto %}
                <img src="{{ resposta.autor.perfil.foto.url }}" alt="Foto de perfil" class="resposta-avatar-img">
            {% else %}
                <img src="/media/Icones/account.png" alt="Foto padr√£o" class="resposta-avatar-img resposta-avatar-padrao">
            {% endif %}

            <strong>
                <a href="{% url 'perfil_usuario' resposta.autor.username %}" class="autor-resposta-9hsf8q">
                    {{ resposta.autor.username }}
                </a>
            </strong>
            <span class="resposta-texto-label">respondeu:</span>
        </div>

        <div class="resposta-conteudo">
            {{ resposta.conteudo|linebreaksbr }}
        </div>

        <small class="resposta-data">{{ resposta.criado_em|date:"d/m/Y H:i" }}</small>

        {% if user == resposta.autor %}
            <div class="resposta-links">
                <a href="{% url 'editar_comentario' resposta.id %}" class="resposta-acao">‚úèÔ∏è Editar</a> |
                <a href="{% url 'deletar_comentario' resposta.id %}" class="resposta-acao">üóëÔ∏è Excluir</a>
            </div>
        {% endif %}

        {% if user.is_authenticated %}
            <p>
                <a href="#" onclick="mostrarFormResposta({{ resposta.id }}); return false;" class="resposta-acao">
                    üí¨ Responder
                </a>
            </p>

            <div id="resposta-form-{{ resposta.id }}" class="resposta-form-container" style="display:none;">
                <form method="post" class="form-comentario-horizontal">
                    {% csrf_token %}
                    <input type="text" name="conteudo" class="comentario-input" placeholder="Escreva uma resposta..." required>
                    <input type="hidden" name="resposta_a" value="{{ resposta.id }}">
                    <button type="submit" class="botao-comentar-horizontal">Responder</button>
                </form>
            </div>
        {% endif %}

        {% include "blog/respostas.html" with respostas=resposta.respostas.all nivel=nivel|add:"1" form=form %}
    </div>

    {% if forloop.last %}
        </div>
    {% endif %}
{% endfor %}

<script>
    function alternarRespostas(comentarioId) {
        const container = document.getElementById(`respostas-do-${comentarioId}`);
        const botao = document.getElementById(`btn-toggle-${comentarioId}`);
        const aberto = container.style.display === 'block';

        container.style.display = aberto ? 'none' : 'block';
        botao.innerHTML = aberto
            ? '<span class="toggle-icon" style="font-weight: 900; font-size: 18px; color: black;">+</span> Mostrar respostas'
            : '<span class="toggle-icon" style="font-weight: 900; font-size: 18px; color: black;">-</span> Ocultar respostas';
    }
</script>
