{% extends 'blog/base.html' %}

{% block content %}
<h1>Perfil de {{ usuario.username }}</h1>

{% if user.is_authenticated %}
    <p>
        Olá, <a href="{% url 'perfil_usuario' user.username %}">{{ user.username }}</a> |
        <a href="{% url 'logout' %}">Sair</a> |
    </p>
{% else %}
    <p>
        <a href="{% url 'login' %}">Login</a> |
        <a href="{% url 'cadastro' %}">Cadastro</a> |
    </p>
{% endif %}

<!-- Foto do perfil -->
{% if perfil.foto %}
    <img id="perfilf" src="{{ perfil.foto.url }}" width="150" style="border-radius: 50%; object-fit: cover;" alt="Foto de perfil">
{% else %}
    <img id="perfilf" src="/media/Icones/account.png" width="150" style="border-radius: 50%; object-fit: cover;" alt="Foto padrão">
{% endif %}
<!-- Bio do usuário -->
<p><strong>Bio:</strong> {{ perfil.bio|default:"Usuário sem bio ainda." }}</p>

<!-- Contagem de seguidores e seguindo -->
<p><strong>Seguidores:</strong> {{ seguidores.count }}</p>
<p><strong>Seguindo:</strong> {{ seguindo.count }}</p>

<!-- Botão de editar bio (só para o dono do perfil) -->
{% if request.user == usuario %}
    <a href="{% url 'editar_perfil' %}">✏️ Editar Bio</a>
{% endif %}

<!-- Botão de seguir/deixar de seguir (só para outros usuários) -->
{% if request.user != usuario %}
    <form method="post" action="{% if request.user in seguidores %}{% url 'deixar_de_seguir' usuario.username %}{% else %}{% url 'seguir_usuario' usuario.username %}{% endif %}">
        {% csrf_token %}
        <button type="submit">
            {% if request.user in seguidores %}
                Deixar de seguir
            {% else %}
                Seguir
            {% endif %}
        </button>
    </form>
{% endif %}

<hr>

   <!-- Lista de posts do usuário -->
<h2>Posts de {{ usuario.username }}</h2>
{% for post in posts %}
    {% include 'blog/post_resumo.html' with post=post %}
{% empty %}
    <p>Este usuário ainda não publicou nada.</p>
{% endfor %}
</ul>

{% endblock %}
